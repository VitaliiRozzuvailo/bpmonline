define("AutoGeneratedPageV2", ["LookupUtilities", "CustomProcessPageV2Utilities"],
	function(LookupUtilities) {
		return {
			mixins: {
				BaseProcessViewModel: "Terrasoft.CustomProcessPageV2Utilities"
			},
			attributes: {},
			entitySchemaName: null,
			details: /**SCHEMA_DETAILS*/{
			}/**SCHEMA_DETAILS*/,
			methods: {
				initCardPrintForms: function(callback, scope) {
					var printMenuItems = this.Ext.create("Terrasoft.BaseViewModelCollection");
					this.set(this.moduleCardPrintFormsCollectionName, printMenuItems);
					if (callback) {
						callback.call(scope || this);
					}
				},

				completeProcessElementWithVerification: function() {
					var pressedButtonName = arguments[3];
					this.asyncValidate(function(result) {
						if (result.success) {
								this.acceptProcessElement(pressedButtonName);
						} else {
							this.showInformationDialog(result.message);
						}
					}, this);
				},
				completeProcessElement: function() {
					this.cancelProcessElement(arguments[3]);
				},
				/**
				 * @protected
				 * @overridden
				 */
				onCloseCardButtonClick: function() {
					this.sandbox.publish("BackHistoryState");
				},
				/**
				 * @protected
				 * @overridden
				 */
				onDiscardChangesClick: function() {
					this.sandbox.publish("BackHistoryState");
				},
				/**
				 * @protected
				 * @overridden
				 */
				initHeaderCaption: Ext.emptyFn,
				/**
				 * @protected
				 * @overridden
				 */
				initPrintButtonMenu: Ext.emptyFn,
				/**
				 * @protected
				 * @overridden
				 */
				getHeader: function() {
					return this.get("header");
				},
				/**
				 * @protected
				 * @overridden
				 */
				init: function() {
					this.set("IsSeparateMode", true);
					this.callParent(arguments);
				},
				/**
				 * @overridden
				 */
				findEntityColumn: function(columnName) {
					var column = this.callParent(arguments);
					if (!column) {
						column = this.getColumnByName(columnName);
					}
					return column;
				},
				/**
				 * @overridden
				 * @param {Object} args Параметры
				 * @param {Object} tag Тег
				 */
				loadVocabulary: function(args, tag) {
					var column = this.findEntityColumn(tag);
					if (!column || !column.isLookup) {
						return;
					}
					var entitySchemaName = column.referenceSchemaName;
					var config = {
						entitySchemaName: entitySchemaName,
						multiSelect: false,
						columnName: tag,
						columnValue: this.get(tag),
						searchValue: args.searchValue
					};
					var handler = function(args) {
						var columnName = args.columnName;
						var collection = args.selectedRows.collection;
						if (collection.length > 0) {
							this.set(columnName, collection.items[0]);
						}
					};
					LookupUtilities.Open(this.sandbox, config, handler, this, null, false, false);
				}
			},
			diff: /**SCHEMA_DIFF*/[
				{
					"operation": "remove",
					"name": "ToolsButton"
				}, {
					"operation": "remove",
					"name": "SaveButton"
				}, {
					"operation": "remove",
					"name": "DiscardChangesButton"
				}, {
					"operation": "remove",
					"name": "DelayExecutionButton"
				}, {
					"operation": "remove",
					"name": "ViewOptionsButton"
				}, {
					"operation": "remove",
					"name": "Tabs"
				}, {
					"operation": "merge",
					"name": "ActionButtonsContainer",
					"values": {
						"visible": true
					}
				}, {
					"operation": "merge",
					"name": "actions",
					"values": {
						"visible": false
					}
				}, {
					"operation": "remove",
					"name": "BackButton"
				}, {
					"operation": "merge",
					"name": "HeaderCaptionContainer",
					"parentName": "CardContentContainer",
					"values": {
						"visible": true
					}
				}, {
					"operation": "remove",
					"name": "Header"
				}, {
					"operation": "insert",
					"name": "AutoGeneratedPageContentContainer",
					"parentName": "CardContentContainer",
					"propertyName": "items",
					"values": {
						"itemType": Terrasoft.ViewItemType.CONTAINER,
						"items": []
					}
				}, {
					"operation": "insert",
					"parentName": "AutoGeneratedPageContentContainer",
					"propertyName": "items",
					"name": "AutoGeneratedPageContentBlock",
					"values": {
						"itemType": Terrasoft.ViewItemType.GRID_LAYOUT,
						"items": []
					}
				}
			]/**SCHEMA_DIFF*/,
			userCode: {}
		};
	});